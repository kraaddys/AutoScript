# üßÆ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ3 ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Python-—Å–∫—Ä–∏–ø—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é Cron –∏ Docker

## üéØ –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–ù–∞—É—á–∏—Ç—å—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å **cron** –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Docker –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Python-—Å–∫—Ä–∏–ø—Ç–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lab03/
‚îú‚îÄ‚îÄ currency_exchange_rate.py   # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
‚îú‚îÄ‚îÄ cronjob                      # –§–∞–π–ª —Å –∑–∞–¥–∞–Ω–∏—è–º–∏ –¥–ª—è cron
‚îú‚îÄ‚îÄ entrypoint.sh                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –∑–∞–ø—É—Å–∫–∞–µ—Ç cron –∏ –≤–µ–¥–µ—Ç –ª–æ–≥–∏
‚îú‚îÄ‚îÄ Dockerfile                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ docker-compose.yml           # –§–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
‚îú‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ data/                        # –ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è JSON-—Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ error.log                    # –õ–æ–≥ –æ—à–∏–±–æ–∫ —Å–∫—Ä–∏–ø—Ç–∞
‚îî‚îÄ‚îÄ .env                         # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
```

---

## ‚öôÔ∏è –ö–∞–∫ —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

### 1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env`

```bash
API_KEY=–í–ê–®_API_–ö–õ–Æ–ß
API_URL=http://host.docker.internal:8080/
# API_AUTH_MODE=form:key | form:api_key | header:bearer | query:key
```

### 2. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
docker compose build
docker compose up -d
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ cron –∑–∞–ø—É—â–µ–Ω

```bash
docker compose exec lab03-cron sh -lc 'ps aux | grep [c]ron'
```

### 4. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é

```bash
docker compose exec lab03-cron sh -lc '\
Y=$(date -d "yesterday" +%F); \
python3 /app/currency_exchange_rate.py --base MDL --target EUR --date "$Y"'
```

---

## ‚è∞ –ó–∞–¥–∞–Ω–∏—è cron

| –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ      | –ó–∞–¥–∞—á–∞    | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| --------------- | --------- | ---------------------------------- |
| –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 06:00 | MDL ‚Üí EUR | –ü–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å –∑–∞ –≤—á–µ—Ä–∞             |
| –ü—è—Ç–Ω–∏—Ü–∞ 17:00   | MDL ‚Üí USD | –ü–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å—ã –∑–∞ –ø—Ä–æ—à–µ–¥—à—É—é –Ω–µ–¥–µ–ª—é |

–õ–æ–≥–∏: `/var/log/cron.log`
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: `/app/data/*.json`

---

## üß© –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker compose exec lab03-cron sh -lc 'tail -n 50 /var/log/cron.log'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```bash
docker compose exec lab03-cron sh -lc 'ls -la /app/data'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API

```bash
docker compose exec lab03-cron sh -lc 'echo "$API_URL" && curl -I "$API_URL"'
```

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ `Invalid API key`

–ò–∑–º–µ–Ω–∏ –≤ `.env` –ø–∞—Ä–∞–º–µ—Ç—Ä —Å–ø–æ—Å–æ–±–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```
API_AUTH_MODE=form:api_key
```

–∏–ª–∏

```
API_AUTH_MODE=header:bearer
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
docker compose down && docker compose up -d --build
```

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

**–ö–æ—Å—Ç—è –°–ª–∞–≤–æ–≤ (I2302)**
–§–∞–∫—É–ª—å—Ç–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏, –ú–ì–£
–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞: –û–±–ª–∞—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è ‚Äî –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ3

