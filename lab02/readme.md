# Лабораторная работа №2. Создание скрипта Python для взаимодействия с API.

## Студент

**Славов Константин, группа I2302**  
**Дата выполнения: _26.09.2025_**

## Цель работы

Целью данной лабораторной работы является разработка скрипта на языке программирования **Python** для взаимодействия с **API**.

## Задание

Этот модуль содержит скрипт `currency_exchange_rate.py`, который обращается к локальному сервису обменных курсов и сохраняет ответ в JSON.

Скрипт должен работать исходя из следующих условий:

1. Получить курс обмена одной валюты по отношению к другой на указанную дату. Валюты и дата должны быть переданы в качестве параметров командной строки.

2. Сохранить полученные данные в файл в формате JSON. Имя файла должно включать валюты и дату запроса. Также, необходимо сохранить файл в каталоге data, который необходимо создать в корне проекта, если он ещё не существует.

3. Обрабатывать ошибки, возникающие при запросах к API (например, недопустимые параметры). Выводить понятные сообщения об ошибках в консоль и сохранять их в файле журнала error.log в корне проекта.

## Ход работы

Для выполнения данной лабораторной работы и достичь требуемого результата понадобится иметь на компьютере следующее:

- Python 3.10+
- Docker + Docker Compose
- Локальный сервис из архива **lab02prep** (PHP + Apache), поднятый на `http://localhost:8080`

После проверки всех компонентов, требуется запустить командную строку. В данном случае, работа будет производиться в **Windows PowerShell**.

### Как запустить сервис (из архива lab02prep)

```bash
cd lab02prep
cp sample.env .env
docker compose up -d
```

Краткое объяснение прописанных команд:

**`cd lab02prep`** - переход в папку с сервисом.

**`cp sample.env .env`** - создается рабочий файл настроек из шаблона, чтобы Docker знал, какой API-ключ использовать.

**`docker compose up -d`** — поднимает все сервисы из файла `docker-compose.yaml` и запустить их в фоне. После этой команды происходит следующее:
- стартуют Apache + PHP;
- приложение из `app/` начинает отвечать на запросы;
- доступно API на `http://localhost:8080`.

![img](https://i.imgur.com/DOZg9Bu.jpeg)

После описанных выше действий, была введена следующая команда:

```bash
curl "http://localhost:8080/?currencies" -Method POST -Body "key=EXAMPLE_API_KEY"
```

Эта команда проверяет, что сервис запущен и работает. Она возвращает список валют, доступных для запросов курсов. После ввода команды на экран выскочило большое количество информации. В данном случае необходимо было найти следующее: **`{"error":"","data":["MDL","USD","EUR","RON","RUS","UAH"]}`**

![img](https://i.imgur.com/tHdEjht.jpeg)

### Установка зависимостей для скрипта

В PowerShell в корне проекта (на уровень выше папки `lab02/`) были прописаны следующие команды:

```bash
python -m venv .venv
#Для Windows использовал следующий тип команды: 
.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```
Краткое объяснение прописанных команд:

**`python -m venv .venv`** - создаёт виртуальное окружение Python в папке .venv. Это отдельное место, где будут храниться библиотеки только для этого проекта, чтобы не мешать другим.

**`.venv\Scripts\Activate.ps1`** - активирует виртуальное окружение в PowerShell. После активации в начале строки появляется (.venv), и теперь все команды python и pip работают внутри этого окружения (ставят пакеты именно туда).

**`pip install -r requirements.txt`** - устанавливает все библиотеки Python, перечисленные в файле `requirements.txt`.

![img](https://i.imgur.com/MbvLnvW.jpeg)

![img](https://i.imgur.com/olLl2Jo.jpeg)

### Переменные окружения

Скрипту нужен API-ключ. Его можно передать параметром `--api-key` или через переменную окружения `API_KEY`:

```powershell
# Для Windows PowerShell:
$env:API_KEY="EXAMPLE_API_KEY"
```

### Запуск скрипта

Для примера запускаем скрипт таким образом:

```bash
python lab02/currency_exchange_rate.py -b USD -t EUR -d 2025-01-01 --api-key EXAMPLE_API_KEY
```

Успешный запуск сохраняет файл в `data/` (в корне проекта), например:

```
data/rate_USD_EUR_2025-01-01.json
```

![img](https://i.imgur.com/09HPT47.jpeg)

![img](https://i.imgur.com/oN4ouB3.jpeg)

Ошибки пишутся в файл `error.log` в корне проекта и выводятся в консоль.

### Ограничения по датам

По условию лабораторной разрешён диапазон дат: **с 2025-01-01 по 2025-09-15**. Скрипт валидирует этот диапазон и формат даты.

### Структура и логика скрипта

- `parse_args()` — парсит аргументы командной строки (`base`, `target`, `date`, `api-url`, `api-key`).
- `validate_currency()` — проверка кода валюты (3 заглавные буквы).
- `parse_date()` — валидация формата и попадания в допустимый диапазон.
- `fetch_rate()` — обращение к API: `POST` на `--api-url` с передачей GET-параметров (`from`, `to`, `date`) и `key` в теле запроса. Обрабатывает сетевые/HTTP ошибки и сообщения `error` в ответе API.
- `save_json()` — сохраняет расширенный JSON в папку `data/` (создаётся при необходимости). Имя файла: `rate_<BASE>_<TARGET>_<DATE>.json`.
- Логирование ошибок — файл `error.log` в корне проекта.

### Тестирование (минимум 5 дат с равными интервалами)

В ходе работы было выбрано 5 дат в диапазоне 2025-01-01..2025-09-15, например:
- 2025-01-01
- 2025-03-01
- 2025-05-01
- 2025-07-01
- 2025-09-01

Для нужной пары валют пишется следующая команда:

```powershell
$dates = @("2025-01-01","2025-03-01","2025-05-01","2025-07-01","2025-09-01")
foreach ($d in $dates) { python lab02/currency_exchange_rate.py -b USD -t EUR -d $d }
```

После чего в консоль выводится следующая информация, а также если перейти в папку **`data`** можно увидеть, что файлы успешно создались и сохранили в себе все нужные данные.

![img](https://i.imgur.com/mefFYPo.jpeg)

![img](https://i.imgur.com/r4SYEtR.jpeg)

Наконец, можно загружать все файлы в отдельную ветку GitHub репозитория. Для этого прописываются следующие команды:

```bash
git init 
git checkout -b lab02 
git add lab02 requirements.txt data/.gitkeep .gitignore 
git commit -m "lab02: currency client script and docs" 
git remote add origin < ссылка-на-репозиторий > 
git push -u origin lab02
```

### Вывод по лабораторной работе

В рамках работы был развернут локальный сервис обмена валют через Docker и проверена его доступность с помощью запроса `curl`. Далее реализован скрипт на Python (`currency_exchange_rate.py`), который принимает валюты и дату из командной строки, отправляет запрос к API и сохраняет результат в формате JSON в папку `data/`. Имя файла формируется по шаблону `rate_<BASE>_<TARGET>_<DATE>.json`.

Скрипт валидирует параметры (правильность кодов валют, диапазон дат `2025-01-01`…`2025-09-15`), обрабатывает ошибки сети и API, выводит сообщения пользователю и ведёт лог ошибок в `error.log`. Для управления зависимостями используется `requirements.txt`, а папка `data/` фиксируется в репозитории с помощью `.gitkeep`.

Было проведено тестирование на пяти датах с равными интервалами, успешно сформированы JSON-файлы. Проект структурирован для публикации на GitHub: код и документация — в `lab02/`, зависимости — в `requirements.txt`, лишние артефакты исключены через `.gitignore`.

Как итог, цель лабораторной работы достигнута: освоено взаимодействие с Web API из Python, работа с параметрами и датами, обработка ошибок и сохранение результатов в файл.
